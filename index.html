<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Home Affairs AI Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <rect width="32" height="32" rx="8" fill="#E60012"/>
                            <path d="M16 8L20 16L16 24L12 16L16 8Z" fill="white"/>
                        </svg>
                    </div>
                    <div class="header-text">
                        <h1>Hong Kong Home Affairs</h1>
                        <p>AI Assistant</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="secure-badge">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 1L3 3V7C3 10.5 5.5 13.5 8 14.5C10.5 13.5 13 10.5 13 7V3L8 1Z" stroke="#4CAF50" stroke-width="2" fill="none"/>
                            <path d="M6 8L7.5 9.5L10 7" stroke="#4CAF50" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Secure Official Source</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-container">
                <h3>API Configuration</h3>
                <div class="settings-form">
                    <div class="form-group">
                        <label for="apiUrl">API URL</label>
                        <input type="url" id="apiUrl" placeholder="http://localhost:3001">
                    </div>
                    <div class="form-group">
                        <label for="apiKey">Developer API Key</label>
                        <input type="password" id="apiKey" placeholder="dak-xxxx-xxxx-xxxx">
                        <small>Enter your WYNI Developer API key</small>
                    </div>
                    <button id="saveSettings" class="btn-primary">Start Chat</button>
                </div>
            </div>
        </div>

        <!-- Main Chat Interface -->
        <main id="chatInterface" class="chat-interface" style="display: none;">
            <!-- Info Banner -->
            <div class="info-banner">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="9" stroke="#003366" stroke-width="2" fill="none"/>
                    <path d="M10 6V10M10 14H10.01" stroke="#003366" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>This assistant provides information exclusively from <strong>had.gov.hk</strong> and <strong>hyab.gov.hk</strong></span>
            </div>

            <!-- Chat Messages Container -->
            <div id="chatMessages" class="chat-messages">
                <div class="welcome-message">
                    <div class="welcome-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <circle cx="32" cy="32" r="32" fill="#F5F7FA"/>
                            <path d="M32 16L40 32L32 48L24 32L32 16Z" fill="#003366"/>
                        </svg>
                    </div>
                    <h3>How can I help you today?</h3>
                    <p>Ask me anything about Hong Kong Home Affairs services, youth programs, community facilities, and more.</p>
                    <div class="suggested-queries">
                        <button class="suggestion-chip" data-query="What are the latest youth grants available?">Youth grants</button>
                        <button class="suggestion-chip" data-query="How do I register for community services?">Community services</button>
                        <button class="suggestion-chip" data-query="What facilities are available in my district?">District facilities</button>
                    </div>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="loading-content">
                    <div class="pulse-animation"></div>
                    <span>Consulting Home Affairs Database...</span>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <textarea 
                        id="messageInput" 
                        placeholder="Ask about Home Affairs services..." 
                        rows="1"
                        maxlength="20000"
                    ></textarea>
                    <button id="sendButton" class="btn-send" disabled>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </main>

        <!-- Citation Drawer -->
        <div id="citationDrawer" class="citation-drawer">
            <div class="drawer-header">
                <div class="drawer-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 2V18M10 2L6 6M10 2L14 6M4 10H16" stroke="#003366" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Source Citations</span>
                </div>
                <button id="closeDrawer" class="btn-close-drawer">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M15 5L5 15M5 5L15 15" stroke="#666" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div id="citationList" class="citation-list">
                <div class="no-citations">
                    <p>Citations will appear here after a query is answered.</p>
                </div>
            </div>
        </div>

        <!-- Settings Button -->
        <button id="settingsButton" class="btn-settings" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12Z" stroke="currentColor" stroke-width="2"/>
                <path d="M17 10C17 10.5 16.5 11 16 11H15.5C15.2 11 15 11.2 15 11.5C15 12 14.8 12.5 14.5 12.9C14.3 13.1 14.3 13.4 14.5 13.6L14.9 14C15.3 14.4 15.3 15 14.9 15.4L15.4 14.9C15 15.3 14.4 15.3 14 14.9L13.6 14.5C13.4 14.3 13.1 14.3 12.9 14.5C12.5 14.8 12 15 11.5 15C11.2 15 11 15.2 11 15.5V16C11 16.5 10.5 17 10 17C9.5 17 9 16.5 9 16V15.5C9 15.2 8.8 15 8.5 15C8 15 7.5 14.8 7.1 14.5C6.9 14.3 6.6 14.3 6.4 14.5L6 14.9C5.6 15.3 5 15.3 4.6 14.9C4.2 14.5 4.2 13.9 4.6 13.5L5 13.1C5.2 12.9 5.2 12.6 5 12.4C4.7 12 4.5 11.5 4.5 11C4.5 10.7 4.3 10.5 4 10.5H3.5C3 10.5 2.5 10 2.5 9.5C2.5 9 3 8.5 3.5 8.5H4C4.3 8.5 4.5 8.3 4.5 8C4.5 7.5 4.7 7 5 6.6C5.2 6.4 5.2 6.1 5 5.9L4.6 5.5C4.2 5.1 4.2 4.5 4.6 4.1C5 3.7 5.6 3.7 6 4.1L6.4 4.5C6.6 4.7 6.9 4.7 7.1 4.5C7.5 4.2 8 4 8.5 4C8.8 4 9 3.8 9 3.5V3C9 2.5 9.5 2 10 2C10.5 2 11 2.5 11 3V3.5C11 3.8 11.2 4 11.5 4C12 4 12.5 4.2 12.9 4.5C13.1 4.7 13.4 4.7 13.6 4.5L14 4.1C14.4 3.7 15 3.7 15.4 4.1C15.8 4.5 15.8 5.1 15.4 5.5L15 5.9C14.8 6.1 14.8 6.4 15 6.6C15.3 7 15.5 7.5 15.5 8C15.5 8.3 15.7 8.5 16 8.5H16.5C17 8.5 17.5 9 17.5 9.5C17.5 10 17 10.5 16.5 10.5H16C15.7 10.5 15.5 10.7 15.5 11" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Settings
        </button>
    </div>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    
    <!-- Config and App -->
    <script src="config.js"></script>
    <script src="config.local.js"></script>
    <script src="app.js"></script>
</body>
</html>
